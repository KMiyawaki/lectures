# UNIX 入門

[Home](../Home.md)

---

## UNIX とは

* オペレーティングシステム (OS) のひとつ
* ***はるか昔から開発されている*** OS
* Windows とか, MacOS X とかと同じ
  * ひとつの計算機を**みんなで使う**時代から
  * **ウィンドウシステム**とか**マウス**とかない時代から
* 特徴
  * ***安定*** している
  * 24時間稼動が当たり前
  * マルチユーザーでの使用にちゃんと対応
    * ***CUI なインターフェイス***

---

## なぜ UNIXか

* ロボットを動かす PC で使用
  * ***ROS*** は Linux 上のほう動かしやすいので
  * 安定動作
* UNIX の種類
  * Linux
    * ***Ubuntu*** <- 今回はこれを使用
    * RedHat
  * MaxOS X
  * FreeBSD
  * HP-UX, Solaris ...

---

## UNIX を使う上での注意点

* 何をしているか ***理解して実行***
  * 「なんとなく」では動かない
  * (権限があれば)簡単に ***やばいこと*** ができる
    * ファイルの全消去
    * 設定変更
    * PCをフリーズ
* ***CUI での開発*** に慣れる
  * キーボードによる操作
  * ***マウスは触るな！***

---

## ファイルシステム

* `/` (ルートディレクトリ)を根とする木構造
  * 区切り文字は`/`
  * **ルートディレクトリからのパス**で一意に決まる
    * `/home/usrs/moto/hoe.txt`とか
* 最近は日本語名のディレクトリ/ファイルも作れる
  * が,何かとトラブルの元なので**やらない方がよい**

---

## ホームディレクトリ

* **ログインしたとき**のディレクトリ
  * `/etc/passwd`内に定義
  * 個人設定ファイルは,だいたいここに置く
  * デスクトップとは別物
* **省略した記述**は「`~`（チルダ）」
  * 環境変数`HOME`に自動でセット
  * `echo $HOME`で確認できる
  * **他人のホームディレクトリ**は`~account`

---

## ディレクトリ関連のコマンド

* 表示
  * `ls`，`pwd`
* 作成，移動
  * `mkdir`，`rmdir`
  * `cd`
* ディレクトリの ***指定方法***
  * 絶対パス：ルートディレクトリからのパス
  * 相対パス：現在位置からのパス
* **特別な記号**
  * 「`.`（ピリオド）」：現在のディレクトリ
  * 「`..`」：ひとつ上のディレクトリ

---

## ファイル操作関連のコマンド

* 作成
* 移動,名前の変更,消去
  * `mv`，`rm`
* 中身の表示,計測
  * `touch`，`cp`
  * `cat`，`more`，`less`，`wc`
* **正規表現**によるファイル(やディレクトリ)の指定
  * 「`*`（アスタリスク）」：任意の文字列(0文字でも可)
  * 「`?`」：任意の 1文字
    * `*/a*.??`とか

---

## 検索

* `find`： ***ファイル自体*** の検索
  * ファイル名で検索

```shell
find . -mtime -10 -print
```

* **最終更新日時**が 10日以内であるファイルを検索

```shell
find . -name hoe.txt -print
```

* 検索されたファイルに対して**コマンドを適用**とかも
  * 最終アクセス日時が 1月以上昔のファイルを消去とか

* `grep`：テキストファイルの ***中身*** を検索
  * 文字列が**書かれているファイル**を検索

```shell
grep "hoe" *.txt
```

---

## 標準入力と標準出力

* UNIX のコマンドは,通常 ***3つの入出力*** を持つ
  * 標準入力
  * 標準出力,標準エラー出力
* `gets()`や`printf()`は,標準入力/出力とのやりとり
  * キーボードからの入力や画面への出力ではない
* 通常は,**標準入力はキーボード**に,**標準出力は画面**に接続している
  * 標準エラー出力も画面に接続しています

***接続先は変更が可能***

---

## パイプとリダイレクト

* あるコマンドの**標準出力**を,別のコマンドの**標準入力**に継ぐ
  * ***パイプ*** ：「`|`」
  * `grep --help | less`とか,`ls | wc`とか
* **ファイルの中身**を標準入力に入れる
  * ***リダイレクト*** ：「`<`」
  * `wc < file.txt`とか
  * 標準出力を**ファイルに書き出す**(`>`とか)もあり

---

## コマンドの使い方がわからないとき

* ヘルプの表示
  * だいたい, `command -h`とか,`command --help`で表示される
  * 簡単な使い方の表示
* オンラインマニュアル

```shell
man command
```

* 概要から使い方まで
* ぐぐる前にチェックすること

---

## ちょっと演習

* いろんなディレクトリにいって,中身を見てみる
* 例えば
  * ホームディレクトリ以下の中身をみる
  * ルートディレクトリの中身を見る
  * `/etc/passwd`等の設定ファイルを見てみる
  * 他人のホームディレクトリを覗く
  * `find`や`grep`を使って検索してみる

* **いろいろなコマンドを試し,結果を見てみること**

---

## 権限の管理

* UNIX は複数のユーザーが同時に利用
  * 勝手に書き替えたりされては大変
  * 重要な設定ファイルは管理者だけ
* 基本方針
  * 個別のファイル(やディレクトリ)ごとに持ち主を定義
  * 持ち主を含め,何ができ,何は禁止なのか定義
    * 設定によっては,持ち主も読めないファイルとかも

---

## 権限の設定

* 権限の設定は3種類
  * 読み取り,書き込み,実行可能
* 権限の設定対象も3種類
  * 自分,同じグループ,他人
* 結局,3×3=9個の権限を設定
  * `rwxrwxrwx`と,9文字で表現
  * `ls -l`で確認可能

---

## グループ

* ユーザは,少なくとも 1つのグループに所属
  * 一般ユーザ,管理者,同じ開発グループ...
* グループに権限を与えると
  * グループメンバーだけ読める
  * グループメンバーだけ書き替えできる
  * グループメンバーだけ実行できる
* グループの所属設定
  * `/etc/group`
  * 自分についての情報は`id`コマンドで確認可能

---

## ディレクトリに対する権限

* ディレクトリについても,同じように権限を設定
  * `r` : ディレクトリ内のファイル一覧が見られる
  * `w` : ディレクトリ内にファイル等を作成・削除可能
  * `x` : ディレクトリ内に(`cd`で)移動可能
* どう設定するか
  * 通常 : `rwxr-xr-x`
  * 秘密なディレクトリ : `rwx------`
  * 特殊な設定 : `rwxrwxrwt`
    * 誰でも作成可能だが,作成した本人にしか削除できない
    * スティッキービット

---

## 権限の設定方法

* `chmod`コマンド
  * (管理者以外は)持ち主だけが設定可能
* 設定方法その1
  * `u+x`，`g-w`といった記号で設定
  * 対象は`u`，`g`，`o`，権限は`+r`とか,`-x`とか
* 設定方法その2
  * 数字の組(`755`とか)で設定
  * `r=4`，`w=2`，`x=1`として,許可した数字を合計

---

## 実習(1)

* ディレクトリやファイルの権限を確認
  * `ls -l`で見てみる
  * 自分の所属グループは`id`で
* 権限が正しく動くか確認

```shell
cd /; touch hoe.txt
cd /tmp; touch hoe.txt
```

* 権限を変更し,動作を確認

```shell
chmod u-r hoe.txt; less hoe.txt
```

* ディレクトリについても

---

## コマンドの実体

* 今まで使用してきたコマンドはどう実装している?
  * 実体は,C言語をコンパイルしてできた実行形式
  * どこかにファイルとして存在
* なぜ, `ls`と打つと,実行できるのか
  * `ls`という名前の実行形式ファイルを探して実行
  * 探す場所(ディレクトリ)は事前に定義
* サーチパス
  * 探す場所を環境変数`PATH`に設定
  * `echo $PATH`で確認可能

---

## 関連するコマンド

* サーチパスの確認

```shell
echo $PATH
```

* 実行形式ファイルの保存場所を表示

```shell
which ls
```

* サーチパスにないファイルはどうすればよいか?
  * サーチパスに加える

```shell
PATH=$PATH:/home/usrs/moto/bin; export PATH
```

* 絶対パスや相対パスで実行
  * `/home/usrs/moto/bin/mycommand`
  * `./mycommand`

---

## コマンドファイルの中身

* 実行できるファイルの条件
  * 実行可能の権限が与えられている
  * 実行可能な形式のファイルである
* 実行可能な形式
  * コンパイル済のバイナリファイル
  * 実行コマンドの指定があるテキストファイル
  * ファイルの中身は,`file`コマンドで表示可能

```shell
file /bin/ls
```

---

## 実行コマンドの指定付きファイル

* 別のコマンド用のプログラムファイル
  * コンパイルするのではなく,直接実行
  * いわゆるスクリプト言語とか
* ファイルの先頭に実行するコマンドを書く

```text
#!python
#!/usr/bin/python
# 2行目以降は,python 用のプログラム
```

* 実行方法(実行権限を与えておくこと)
  * `./filename.py`とするだけ
  * `/usr/bin/python ./filename.py`としたのと同じ

---

## ちょっと変態的な例ですが

* 以下のようなファイル`textfile.txt`を作成

```shell
#!/usr/bin/emacs -nw

textline
nextline
```

* 実行権限を与える

```shell
chmod +x textfile.txt
```

* 実行すると,編集できる

```shell
./textfile.txt
（/usr/bin/emacs -nw textfile.txt と同じ）
```

---

## 実習(2)

* いろいろなコマンドの保存場所を探す

```shell
which ls
```

* `PATH`の値を変えてみる
  * パスを追加,削除
    * `export PATH` (内容の更新)を忘れずに
  * 個人設定ファイル(`.bashrc`とか)に書くと,次回ログイン時にも反映される
* 実行コマンド指定付きテキストファイルを作成
  * 実行権限を与えて実行してみる

---

[Home](../Home.md)
